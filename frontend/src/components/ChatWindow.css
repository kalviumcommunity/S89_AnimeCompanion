/* frontend/src/components/ChatWindow.css (FINAL AND COMPLETE - MOBILE OVERLAY SIDEBAR FIX) */

/* Define variables for consistent structure and glass theme colors */
:root {
    /* Structural variable for centered content width (approximate ChatGPT width) */
    --content-max-width: 760px !important; 
    /* Glass Effect Colors (using original values) */
    --glass-sidebar-bg: rgba(255,255,255,0.08) !important;
    --text-primary: #ffffff !important;
    
    /* BLUE ACCENTS */
    --mac-blue-strong: rgba(10, 132, 255, 0.75) !important;     
    --mac-blue-active-sidebar: rgba(10, 132, 255, 0.35) !important; 
    
    /* NEW BLUE TRANSPARENT BUBBLE BACKGROUNDS */
    --user-bubble-bg: rgba(10, 132, 255, 0.85) !important;        /* Stronger Blue (User) */
    --model-bubble-bg: rgba(255, 255, 255, 0.3) !important;    /* Lighter Transparent (Model) */
}

/* ------------------------------------------- */
/* 1. GLOBAL LAYOUT (App Container) */
/* ------------------------------------------- */

.app-container {
    position: relative !important;
    display: flex !important; /* CRITICAL: Enables horizontal sizing */
    width: 100% !important;
    height: 100% !important; 
    min-height: 0 !important; 
    overflow: hidden !important; 
    background: transparent !important; 
    border-radius: 16px !important;
    box-sizing: border-box !important;
}

/* ------------------------------------------- */
/* 2. SIDEBAR STYLES (app-sidebar - CRITICAL MIN-WIDTH ADDITIONS) */
/* ------------------------------------------- */
.app-sidebar {
    width: 260px !important;
    /* >> CRITICAL ADDITION 1: Prevents the sidebar from shrinking when open */
    min-width: 260px !important; 
    
    /* Transparent Glass Effect */
    background: var(--glass-sidebar-bg) !important;
    color: var(--text-primary) !important;
    padding: 12px 10px !important; 
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important;
    flex-shrink: 0 !important;
    border-right: 1px solid rgba(255,255,255,0.2) !important; 
    /* NO BLUR */
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    box-shadow: 0 0 10px rgba(0,0,0,0.4) !important;
    position: relative !important;
    z-index: 10 !important;
    /* >> CRITICAL UPDATE 1: Include min-width in transition */
    transition: width 250ms ease, padding 250ms ease, min-width 250ms ease !important;
    border-radius: 16px 0 0 16px !important;
}

/* Collapsed state */
.app-sidebar.collapsed {
    width: 0 !important; 
    /* >> CRITICAL ADDITION 2: Allows sidebar to fully collapse */
    min-width: 0 !important; 
    padding: 0 !important; 
    overflow: hidden !important;
}

/* Sidebar Header (New Chat Button - NO BLUR) */
.sidebar-header-controls {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    margin-bottom: 12px !important;
    padding: 0 !important; 
}

/* New Chat Button (NO BLUR) */
.new-chat-btn {
    width: 100% !important;
    background: rgba(255, 255, 255, 0.15) !important; 
    color: white !important;
    padding: 10px 14px !important;
    border: 1px solid rgba(255, 255, 255, 0.3) !important; 
    border-radius: 6px !important; 
    font-weight: 500 !important;
    justify-content: flex-start !important;
    /* NO BLUR */
    backdrop-filter: none !important;
    transition: background 0.15s !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
}

.new-chat-btn:hover {
    background: rgba(255, 255, 255, 0.25) !important;
}

/* Sidebar Toggle Button */
.sidebar-toggle-btn {
    display: none !important; 
}

/* Sidebar List */
.conversation-list-container {
    flex-grow: 1 !important;
    overflow-y: auto !important; 
    min-height: 0 !important; 
    padding-right: 4px !important; 
    -webkit-overflow-scrolling: touch !important;
}

.no-chats-message {
    padding: 10px 0 !important;
    font-size: 0.9rem !important;
    color: #a0a0a0 !important;
    text-align: center !important;
}

.chat-history-list {
    display: flex !important; 
    flex-direction: column !important;
    gap: 4px !important; 
}

.chat-history-item {
    padding: 10px 10px !important; 
    border-radius: 6px !important;
    cursor: pointer !important;
    background: transparent !important;
    transition: background 0.18s !important;
    position: relative !important;
    color: var(--text-primary) !important;
    display: flex !important;
    align-items: center !important;
    gap: 10px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
}

.chat-history-item:hover {
    background: rgba(255,255,255,0.1) !important; 
}

.chat-history-item.active {
    background: var(--mac-blue-active-sidebar) !important; 
    font-weight: 600 !important;
}

.chat-title {
    flex-grow: 1 !important;
    margin: 0 !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    font-size: 0.9rem !important;
    line-height: 1.2 !important;
}

.chat-icon {
    flex-shrink: 0 !important;
    color: #a0a0a0 !important;
}

.delete-chat-btn {
    flex-shrink: 0 !important;
    background: transparent !important;
    border: none !important;
    padding: 0 !important;
    width: 20px !important;
    height: 20px !important;
    color: #d1d5db !important;
    margin-left: auto !important;
    transition: color 0.15s !important;
}
.delete-chat-btn:hover {
    color: #ef4444 !important;
    background: transparent !important;
}

.sidebar-footer {
    border-top: 1px solid rgba(255, 255, 255, 0.15) !important;
    padding-top: 12px !important;
    margin-top: auto !important; 
}

.settings-btn {
    width: 100% !important;
    background: transparent !important;
    border: none !important;
    color: #d1d5db !important;
    padding: 8px 10px !important;
    border-radius: 8px !important;
    display: flex !important;
    align-items: center !important;
    gap: 10px !important;
    justify-content: flex-start !important;
}
.settings-btn:hover {
    background: rgba(255, 255, 255, 0.1) !important;
    color: #fff !important;
}


/* ------------------------------------------- */
/* 3. MAIN CHAT AREA (chat-main-content - CRITICAL MIN-WIDTH ADDITION) */
/* ------------------------------------------- */

.chat-main-content {
    flex-grow: 1 !important;
    /* >> CRITICAL ADDITION 3: Allows the main content to shrink when the sidebar is open */
    min-width: 0 !important; 
    
    display: flex !important;
    flex-direction: column !important;
    height: 100% !important; 
    min-height: 0 !important; 
    background: rgba(0, 0, 0, 0.2) !important;
    border: 1px solid rgba(255,255,255,0.1) !important; 
    /* NO BLUR */
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    position: relative !important;
    z-index: 5 !important;
    border-radius: 0 16px 16px 0 !important; 
    overflow: hidden !important;
}

/* Full border-radius when sidebar is collapsed (or not used) */
.app-container:not(.sidebar-open) .chat-main-content {
    border-radius: 16px !important;
}

/* Message Display Area */
.messages-display-area {
    flex-grow: 1 !important; 
    padding: 0 20px !important; 
    overflow-y: auto !important; 
    min-height: 0 !important; 
    
    max-width: var(--content-max-width) !important;
    width: 100% !important;
    margin: 0 auto !important;
    padding-top: 20px !important;
    padding-bottom: 20px !important; 
    display: flex !important; 
    flex-direction: column !important;
    gap: 15px !important; 
}

/* --- Initial/Empty Screen Styles --- */
.initial-message-screen {
    max-width: var(--content-max-width) !important; 
    margin: 0 auto !important;
}


/* ------------------------------------------- */
/* 4. MESSAGE BUBBLE STYLES (Bubbles Restored) */
/* ------------------------------------------- */

.message-row {
    display: flex !important;
    padding: 0 !important; 
    border-bottom: none !important; 
    margin: 0 !important;
    width: 100% !important;
}

/* User Message (Aligned Right) */
.user-row {
    justify-content: flex-end !important;
    background-color: transparent !important;
}

/* Model Message (Aligned Left) */
.model-row {
    justify-content: flex-start !important;
    background-color: transparent !important;
}

/* Bubble Content Wrapper (This creates the bubble shape) */
.message-content {
    max-width: 85% !important; 
    width: auto !important;
    padding: 12px 18px !important;
    line-height: 1.5 !important;
    color: var(--text-primary) !important;
    border-radius: 18px !important;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3) !important;
    text-align: left !important;
    position: relative !important; 
}

/* User Bubble (Blue Color) */
.user-row .message-content {
    background: var(--user-bubble-bg) !important; 
    color: #fff !important;
    border-radius: 18px 18px 6px 18px !important; /* Tail right-bottom */
    margin-right: 0 !important;
}

/* Model Bubble (Light Glass Color) */
.model-row .message-content {
    background: var(--model-bubble-bg) !important;
    color: var(--text-primary) !important;
    border-radius: 18px 18px 18px 6px !important; /* Tail left-bottom */
    margin-left: 0 !important;
}

/* Hide Icons - Icons are generally not used when using the bubble style */
.message-icon {
    display: none !important;
}

.message-meta strong {
    display: none !important; 
}

.message-text {
    font-size: 1rem !important;
}

/* --- MARKDOWN STYLES (Code blocks inside bubbles) --- */
.message-text pre {
    background: rgba(0, 0, 0, 0.5) !important; 
    color: #fff !important;
    padding: 10px !important;
    border-radius: 6px !important;
    margin: 10px 0 !important;
}
.message-text code {
    background: rgba(255, 255, 255, 0.15) !important; 
    padding: 2px 5px !important;
    border-radius: 3px !important;
}


/* --- Thinking Indicator (3 dots) --- */
.loading-dots {
    display: flex !important;
    align-items: center !important;
    gap: 4px !important;
    min-height: 20px !important;
}

/* ------------------------------------------- */
/* 5. INPUT FORM (Fixed at Bottom, Centered - LIQUID GLASS) */
/* ------------------------------------------- */

.chat-input-area-wrapper {
    position: sticky !important;
    bottom: 0 !important;
    /* Soft gradient fade from the bottom, necessary because we removed the blur from the main content */
    background: linear-gradient(to top, rgba(0, 0, 0, 0.5), transparent) !important; 
    flex-shrink: 0 !important; 
    padding: 24px 0 16px 0 !important; 
    border-top: none !important;
    
    width: 100% !important;
    max-width: var(--content-max-width) !important;
    margin: 0 auto !important;
}

.chat-input-form {
    display: flex !important;
    /* Use align-items: flex-end to keep the input at the bottom as it grows */
    align-items: flex-end !important; 
    /* üéØ MODIFIED: Reduced horizontal padding to allow full input width and increased vertical padding for chat-like appearance */
    padding: 8px 12px !important; 
    /* Glass Border and Background */
    border: 1px solid rgba(255,255,255,0.2) !important; 
    /* ‚ùå REMOVED: Black background */
    background: transparent !important; 
    /* NO BLUR */
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    border-radius: 12px !important; 
    gap: 10px !important;
    /* ‚ùå CRITICAL FIX: Ensure no box shadow is present */
    box-shadow: none !important;
}

/* TARGET THE TEXTAREA (Auto-growing Input) */
.chat-input-form textarea {
    flex-grow: 1 !important;
    /* üéØ CRITICAL FIX: Prevents text content from pushing the container horizontally */
    min-width: 0 !important; 
    
    /* üéØ MODIFIED: Add back vertical padding inside the textarea for the appearance of the text resting in the middle/bottom */
    padding: 8px 0 !important; 
    
    /* === LIQUID GLASS INPUT STYLES === */
    background: transparent !important; /* Make the input itself transparent */
    border: none !important; /* Remove native border */
    outline: none !important; /* Remove focus outline */
    
    /* === AUTO-RESIZE STYLES === */
    resize: none !important; /* Disable native user resizing */
    /* üéØ CRITICAL: Allow vertical scroll when max height is hit */
    overflow-y: auto !important; 
    line-height: 1.5 !important; /* Set line height for accurate JS sizing */
    font-family: inherit !important; /* Important for accurate scrollHeight calculation */
    /* ================================= */
    
    color: #f3f4f6 !important;
    font-size: 1rem !important;
    min-height: 20px !important; 
    /* üéØ NEW: Set Max Height (e.g., 200px or 6 lines) */
    max-height: 200px !important; 
}

/* Ensure focus is subtle and doesn't break the glass aesthetic */
.chat-input-form textarea:focus {
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
}

/* Send Button */
.send-btn {
    /* üéØ MODIFIED: Increased size and padding for better click target */
    width: 36px !important;
    height: 36px !important;
    padding: 0 !important; 
    border-radius: 8px !important; 
    background: #0a84ff !important;
    border: none !important;
    flex-shrink: 0 !important; /* Prevents button from being squeezed */
    
    /* üéØ NEW: Position the button closer to the bottom edge of the input area */
    align-self: flex-end !important;
}
.send-btn:disabled {
    opacity: 0.5 !important;
    cursor: not-allowed !important;
}
.send-btn svg {
    /* üéØ MODIFIED: Increased icon size */
    width: 18px !important; 
    height: 18px !important;
    fill: currentColor !important;
}

/* ------------------------------------------- */
/* 6. RESPONSIVE & MOBILE TWEAKS */
/* ------------------------------------------- */

@media (max-width: 800px) {
    /* Mobile Layout: Sidebar slides in over content */
    .app-sidebar {
        /* üéØ CRITICAL FIX: Make the sidebar fixed and overlay the content */
        position: fixed !important;
        height: 100% !important;
        top: 0 !important;
        left: 0 !important;
        z-index: 100 !important; /* Ensure it's on top of everything */
        /* NO BLUR */
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
        /* Start off-screen */
        transform: translateX(-100%) !important;
        transition: transform 250ms ease !important;
    }

    /* üéØ NEW: Move sidebar into view when 'sidebar-open' class is present */
    .app-container.sidebar-open .app-sidebar {
        transform: translateX(0) !important;
    }
    
    /* Remove min-width restriction when sidebar is open on mobile */
    .app-container.sidebar-open .chat-main-content {
        min-width: 100% !important; 
        overflow: hidden !important; /* Prevent main content from scrolling when sidebar is open */
    }


    .messages-display-area {
        max-width: 100% !important; 
        padding: 0 10px !important;
    }
    
    .chat-input-area-wrapper {
        max-width: 100% !important;
        padding: 16px 10px 8px 10px !important;
    }
    
    /* Mobile row adjustments */
    .user-row {
        justify-content: flex-end !important; 
        padding: 0 !important;
        margin: 0 !important;
    }
    .model-row {
        justify-content: flex-start !important;
        padding: 0 !important;
        margin: 0 !important;
    }
    
    .message-content {
        max-width: 95% !important;
    }
}